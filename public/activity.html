<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Activity Feed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body>
  <main>
    <section class="profile-section">
      <a href="/"><img src="/images/mouse.jpeg" class="profile-image" /></a>
      <div class="profile-info">
        <h1>Max Ischenko</h1>
        <div class="bio-content">–°–ø–æ—á–∞—Ç–∫—É –î–û–£, —Ç–µ–ø–µ—Ä Djinni. Keep going &amp; –ø—ñ–¥—Ç—Ä–∏–º—É–π –ó–°–£.</div>
        <div class="profile-nav">
          <a href="/">Home</a>
          <a href="/about">About me</a>
          <a href="/activity" class="active">Activity</a>
        </div>
      </div>
    </section>

    <h2>Recent Activity</h2>
    <div id="activity-feed" class="xpost-card">Loading...</div>
  </main>
  <footer>&copy; 2025 Max Ischenko</footer>
<script type="module">
  async function loadActivity() {
    const res = await fetch('/api/activity');
    const items = await res.json();
    const container = document.getElementById('activity-feed');
    container.innerHTML = '';

    let currentDate = '';

    for (const item of items) {
      const dt = new Date(item.created_at);
      const dateStr = dt.toLocaleDateString(undefined, {
        year: 'numeric', month: 'long', day: 'numeric'
      });

      if (dateStr !== currentDate) {
        currentDate = dateStr;
        const dateHeader = document.createElement('h3');
        dateHeader.textContent = dateStr;
        dateHeader.style.marginTop = '2rem';
        container.appendChild(dateHeader);
      }

      const timeStr = dt.toLocaleTimeString(undefined, {
        hour: '2-digit', minute: '2-digit'
      });

const baseSummary = {
  post: `‚úçÔ∏è New post: "${item.data?.snippet || '...'}"`,
  reaction: `üîÅ Reaction on post ${item.post_id}: ${item.data?.emoji}`,
  view: `üëÅÔ∏è View on post ${item.post_id}`,
  session: `üîê New session from ${item.data?.device || 'Unknown'}`,
  timeline: `üóÇÔ∏è Timeline opened${item.data?.referrer ? ` (ref: ${item.data.referrer})` : ''}`
}[item.type] || '‚ÑπÔ∏è Unknown event';

      const summary = item.anon_id
        ? `${baseSummary} [${item.anon_id}]`
        : baseSummary;

      const el = document.createElement('div');
      el.style.margin = '0.5rem 0';
      el.innerHTML = `<span style="color:#555;"><strong>${timeStr}</strong></span> ‚Äî ${summary}`;
      container.appendChild(el);
    }
  }

  loadActivity();
</script>
</body>
</html>

